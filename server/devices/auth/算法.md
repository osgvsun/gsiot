# 权限验证算法
## 查找用户
1. 查找本地记录
2. 查找物联服务
3. 查找用户中心

## 权限验证
1. 不需要认证
2. 在白名单上认证
3. 在网络上认证

## 要做什么
1. 根据查询权限所得
2. 根据本地状态自动获取

## 怎么实现
### 算法
1. 通过尝试不同的方式，寻找一种可以得到结果的返回
2. 

### 流程
- 查找本地白名单
  - 找不到，先找用户
  - 找到用户后，没找到权限，则
    - 如果不需要权限，则返回
    - 如果需要自动生'成权限，则查询状态后生成
    - 如果需要权限，则到物联服务上找权限
- 得到的结果是user和policys

- 到本地缓存找用户
- 找不到，则到物联服务上找权限
- 找不到，则到用户中心上找用户
### 伪代码
```python
gsfunction(searchlocalpolicy,,username=usernmae,card=card)       # 首先查找本地白名单
    .fail(searchuserbuff,username=usernmae,card=card)            # 再次查找本地缓存
    .fail(searchiotserver,username=usernmae,card=card)           # 再次查找物联服务
    .fail(serchusercenter,username=usernmae,card=card)           # 再次查找用户中心
    .Then(
    gsfunction(checkpolicy,user=user,policy=policy)              # 找到了则检查权限
        .fail.fail(searchiotserver,,user=user)                   # 需要权限又没有权限时查找物联服务
        .Then(checkpolicy,user=user,policy=policy)  
    )
if   not user:nouser()
elif not policy:
    if   cfg.nodo:alert()
    elif cfg.auto:do()
    else:nopolicy()
elif policy.start <=now<policy.end:do(policy.devindex)
else:notime()
```